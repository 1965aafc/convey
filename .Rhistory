quant_val <- as.vector(quant_val)
ARPT <- percent* quant_val
lin_ARPT <- percent * iqalpha(formula = formula, design = design,
alpha = order,h=h, ncom=ncom, comp=FALSE,incvec = NULL)$lin
names(lin_ARPT)<-ind
lin_ARPT_comp<-complete(lin_ARPT, ncom)
if(comp)lin<-lin_ARPT_comp else lin<-lin_ARPT
v<-svyCprod(lin/design$prob,design$strata,
design$cluster[[1]], design$fpc,
design$nPSU,design$certainty,design$postStrata)
list(value = ARPT, lin = lin, se=sqrt(v))
}
fun_arptd<- svyby(~eqIncome, by= ~db040, design=des_eusilc, FUN=svyarpt, order = .50, percent =.6,
h= htot,ncom=nrow(des_eusilc$variables), comp=TRUE, deff=FALSE, keep.var=FALSE, keep.names = TRUE)
source('~/GitHub/convey/tests.R', echo=TRUE)
fun_arptw <-  svyarpt(~eqIncome, design=des_eusilc, .5, .6, h=htot,
ncom=nrow(des_eusilc$variables), comp=TRUE)
library(vardpoor)
library(vardpoor)
data(eusilc)
library(survey)
htot <- h_fun(eusilc$eqIncome, eusilc$rb050)
des_eusilc <- svydesign(ids=~db040, weights=~rb050, data=eusilc)
svyarpt(~eqIncome, design=des_eusilc, .5, .6, h = htot, ncom=nrow(eusilc), comp=TRUE)
source('~/GitHub/convey/R/svyarpt.R', echo=TRUE)
svyarpt.survey.design <- function(formula, design, order = .50, percent =.6, h, ncom, comp,...) {
w <- weights(design)
ind<-names(w)
quant_val<- svyquantile(x = formula, design=design,
quantiles = order, method="constant")
quant_val <- as.vector(quant_val)
ARPT <- percent* quant_val
lin_ARPT <- percent * iqalpha(formula = formula, design = design,
alpha = order,h=h, ncom=ncom, comp=FALSE,incvec = NULL)$lin
names(lin_ARPT)<-ind
lin_ARPT_comp<-complete(lin_ARPT, ncom)
if(comp)lin<-lin_ARPT_comp else lin<-lin_ARPT
list(value = ARPT, lin = lin)
}
svyarpt(~eqIncome, design=des_eusilc, .5, .6, h = htot, ncom=nrow(eusilc), comp=TRUE)
install_github("DjalmaPessoa/convey")
ls()
rm?
?rm
rm(list = ls())
library(convey)
source('~/GitHub/convey/tests.R', echo=TRUE)
source('~/GitHub/convey/tests.R', echo=TRUE)
fun_arptw$value
table(fun_arptw$lin)
vardpoor_arptw$value
table(vardpoor_arptw$lin$lin_arpt)
devtools::use_testthat()
devtools::test()
library(convey)
source('~/GitHub/convey/tests.R', echo=TRUE)
source('~/GitHub/convey/tests.R', echo=TRUE)
fun_arptw <-  svyarpt(~eqIncome, design=des_eusilc, .5, .6, h=htot,
ncom=nrow(des_eusilc$variables), comp=TRUE)
str(fun_arptw)
?vcov
svyarpt.svyrep.design <- function(formula, design, order = .50, percent =.6,...) {
inc <- terms.formula(formula)[[2]]
df <- model.frame(design)
incvar<-df[[as.character(inc)]]
w <- weights(design, "sampling")
quant_val <- computeQuantiles(incvar, w,  p = order)
quant_val <- as.vector(quant_val)
rval <- percent* quant_val
ww<-weights(design,"analysis")
qq <- apply(ww, 2, function(wi) 0.6*computeQuantiles(incvar, wi,p = order))
variance <- svrVar(qq,design$scale,design$rscales, mse=design$mse, coef=rval)
list(value= rval, se=sqrt(variance))
}
fun_arptw <-  svyarpt.svyrep.design(~eqIncome, design=des_eusilc, .5, .6, h=htot,
ncom=nrow(des_eusilc$variables), comp=TRUE)
svyarpt.survey.design <- function(formula, design, order = .50, percent =.6, h, ncom, comp,...) {
w <- weights(design)
ind<-names(w)
quant_val<- svyquantile(x = formula, design=design,
quantiles = order, method="constant")
quant_val <- as.vector(quant_val)
ARPT <- percent* quant_val
lin_ARPT <- percent * iqalpha(formula = formula, design = design,
alpha = order,h=h, ncom=ncom, comp=FALSE,incvec = NULL)$lin
names(lin_ARPT)<-ind
lin_ARPT_comp<-complete(lin_ARPT, ncom)
if(comp)lin<-lin_ARPT_comp else lin<-lin_ARPT
attr(ARPT, "statistic")<- "arpt"
attr(ARPT, "var")<-svyCprod(lin/design$prob,design$strata,
design$cluster[[1]], design$fpc,
design$nPSU,design$certainty,design$postStrata)
#list(value = ARPT, lin = lin)
return(ARPT)
}
svyarpt.survey.design <- function(formula, design, order = .50, percent =.6, h, ncom, comp,...) {
w <- weights(design)
ind<-names(w)
quant_val<- svyquantile(x = formula, design=design,
quantiles = order, method="constant")
quant_val <- as.vector(quant_val)
ARPT <- percent* quant_val
lin_ARPT <- percent * iqalpha(formula = formula, design = design,
alpha = order,h=h, ncom=ncom, comp=FALSE,incvec = NULL)$lin
names(lin_ARPT)<-ind
lin_ARPT_comp<-complete(lin_ARPT, ncom)
if(comp)lin<-lin_ARPT_comp else lin<-lin_ARPT
attr(ARPT, "statistic")<- "arpt"
attr(ARPT, "var")<-svyCprod(lin/design$prob,design$strata,
design$cluster[[1]], design$fpc,
design$nPSU,design$certainty,design$postStrata)
#list(value = ARPT, lin = lin)
return(ARPT)
}
fun_arptw <-  svyarpt.survey.design(~eqIncome, design=des_eusilc, .5, .6, h=htot,
ncom=nrow(des_eusilc$variables), comp=TRUE)
svyCprod(eusilc$eqIncome/des_eusilc$prob,des_eusilc$strata,
des_eusilc$cluster[[1]], des_eusilc$fpc,
des_eusilc$nPSU,des_eusilc$certainty,des_eusilc$postStrata)
des_eusilc$nPSU
des_eusilc$nPSU
str(des_eusilc)
svyCprod(eusilc$eqIncome/des_eusilc$prob,des_eusilc$strata,
des_eusilc$cluster[[1]], des_eusilc$fpc,
des_eusilc$nPSU,des_eusilc$certainty,des_eusilc$postStrata)
str(des_eusilc$fpc)
table(des_eusilc$fpc$sampsize)
survey:::svyCprod->teste
library(debug)
mtrace(teste)
teste(eusilc$eqIncome/des_eusilc$prob,des_eusilc$strata,
des_eusilc$cluster[[1]], des_eusilc$fpc,
des_eusilc$nPSU,des_eusilc$certainty,des_eusilc$postStrata)
?svydesign
des_eusilc <- svydesign(ids=~db040, weights=~rb050, data=eusilc)
str(des_eusilc$fpc)
inherits(des_eusilc$fpc,"formula")
library("convey", lib.loc="~/R/win-library/3.2")
library(vardpoor)
data(eusilc)
library(survey)
htot <- h_fun(eusilc$eqIncome, eusilc$rb050)
des_eusilc <- svydesign(ids=~db040, weights=~rb050, data=eusilc)
arpt_eusilc<-svyarpt(~eqIncome, design=des_eusilc, .5, .6, h = htot, ncom=nrow(eusilc), comp=TRUE)
arpr_eulsilc<- svyarpr_lin(~eqIncome, design=des_eusilc, .5, .6, h = htot,
ARPT = arpt_eusilc, ncom=nrow(eusilc), comp=TRUE)
arpr_eulsilc<- svyarpr(~eqIncome, design=des_eusilc, .5, .6, h = htot,
ARPT = arpt_eusilc, ncom=nrow(eusilc), comp=TRUE)
devtools::document()
?svyarpt
devtools::document()
?vsyarpt
devtools::document()
library(vardpoor)
data(eusilc)
library(survey)
htot <- h_fun(eusilc$eqIncome, eusilc$rb050)
des_eusilc <- svydesign(ids=~db040, weights=~rb050, data=eusilc)
svygini(~eqIncome, design=des_eusilc, ncom=nrow(eusilc), comp=TRUE)
library(vardpoor)
data(eusilc)
library(survey)
htot <- h_fun(eusilc$eqIncome, eusilc$rb050)
des_eusilc <- svydesign(ids=~db040, weights=~rb050, data=eusilc)
qsr_eqIncome<- svyqsr(~eqIncome, design=des_eusilc, alpha= .20, ncom = nrow(eusilc),
comp=TRUE, incvec = eusilc$eqIncome)
library(vardpoor)
data(eusilc)
library(survey)
htot <- h_fun(eusilc$eqIncome, eusilc$rb050)
des_eusilc <- svydesign(ids=~db040, weights=~rb050, data=eusilc)
arpt_eqIncome <-svyarpt(~eqIncome, design=des_eusilc, .5, .6, h = htot,
ncom=nrow(eusilc), comp=TRUE)
devtools::document()
?svygini
library(vardpoor)
data(eusilc)
library(survey)
htot <- h_fun(eusilc$eqIncome, eusilc$rb050)
des_eusilc <- svydesign(ids=~db040, weights=~rb050, data=eusilc)
icdf_eqIncome <-icdf(~eqIncome, design=des_eusilc, 20000, ncom=nrow(eusilc), comp=TRUE)
icdf_eqIncome$value
icdf<-function(formula, design, x, ncom, comp, ...){
inc <- terms.formula(formula)[[2]]
df <- model.frame(design)
incvar<-df[[as.character(inc)]]
w <- weights(design)
ind<-names(w)
N <- sum (w)
poor<- (incvar<=x)*1
design <- update(design, poor = poor)
# rate of poor
cdf_fun <- coef(svymean(poor, design))
inf_fun<-(1/N)* ((incvar<=x)-cdf_fun)
names(inf_fun)<-ind
inf_fun_comp<- complete(inf_fun,ncom)
if(comp)lin<-inf_fun_comp else lin<-inf_fun
list(value= cdf_fun, lin=lin)
}
icdf_eqIncome <-icdf(~eqIncome, design=des_eusilc, 20000, ncom=nrow(eusilc), comp=TRUE)
icdf_eqIncome$value
library(vardpoor)
data(eusilc)
library(survey)
htot <- h_fun(eusilc$eqIncome, eusilc$rb050)
des_eusilc <- svydesign(ids=~db040, weights=~rb050, data=eusilc)
iqalpha_eqIncome <-icdf(~eqIncome, design=des_eusilc, .50, ncom=nrow(eusilc),
comp=TRUE, eusilc$eqIncome )
iqalpha_eqIncome$value
iqalpha_eqIncome <-iqalpha(~eqIncome, design=des_eusilc, .50, ncom=nrow(eusilc),
comp=TRUE, eusilc$eqIncome )
iqalpha_eqIncome$value
#' of the library survey
library(vardpoor)
data(eusilc)
library(survey)
htot <- h_fun(eusilc$eqIncome, eusilc$rb050)
des_eusilc <- svydesign(ids=~db040, weights=~rb050, data=eusilc)
isq_eqIncome <-isq(~eqIncome, design=des_eusilc, .80, "sup", htot,
ncom=nrow(eusilc),  eusilc$eqIncome)
isq_eqIncome$value
devtools::document()
? isq
devtools::document()
SE_lin <- function(object, design){
lincomp<- object$lin
lapply(lincomp$statistic.lin,
function(t){
x<- update(design,t=t)
SE(svytotal(~t,design ) )
}
)
}
SE_lin(fun_ginid)
source('~/GitHub/convey/tests.R', echo=TRUE)
source('~/GitHub/convey/tests.R', echo=TRUE)
library(convey,pos=1)
source('~/GitHub/convey/tests.R', echo=TRUE)
svyarpt.survey.design
source('~/GitHub/convey/R/svyarpt.R', echo=TRUE)
source('~/GitHub/convey/tests.R', echo=TRUE)
names(fun_arptw)
fun_arptw <-  svyarpt.survey.design(~eqIncome, design=des_eusilc, .5, .6, h=htot,
ncom=nrow(des_eusilc$variables), comp=TRUE)
str(fun_arptw)
source('~/GitHub/convey/R/svyarpt.R', echo=TRUE)
source('~/GitHub/convey/tests.R', echo=TRUE)
source('~/GitHub/convey/tests.R', echo=TRUE)
SE_lin(fun_ginid)
SE_lin(fun_ginid,des_eusilc )
SE_lin <- function(object, design){
lincomp<- object$lin
list_se<-lapply(lincomp$statistic.lin,
function(t){
x<- update(design,t=t)
SE(svytotal(~t,design ) )
}
)
list_se
}
SE_lin(fun_ginid,des_eusilc )
SE_lin <- function(object, design){
lincomp<- object$lin
list_se<-lapply(lincomp$statistic.lin,
function(t){
x<- update(design,t=t)
SE(svytotal(~t,design ) )
}
)
list_se
}
SE_lin(fun_ginid,des_eusilc )
SE_lin <- function(object, design){
lincomp<- object$lin
list_se<-lapply(lincomp$statistic.lin,
function(t){
x<- update(design,t=t)
SE(svytotal(~t,design ) )
}
)
list_se
}
str(fun_ginid)
SE_lin <- function(object, design){
lincomp<- object$statistic.lin
list_se<-lapply(lincomp,
function(t){
x<- update(design,t=t)
SE(svytotal(~t,design ) )
}
)
list_se
}
SE_lin(fun_ginid,des_eusilc )
SE_lin <- function(object, design){
lincomp<- object$statistic.lin
list_se<-lapply(lincomp,
function(t){
x<- update(design,t=t)
SE(svytotal(~t,design ) )
}
)
names(list_se)<-object[[1]]
list_se
}
SE_lin(fun_ginid,des_eusilc )
SE_lin(fun_giniw,des_eusilc )
str(fun_giniw)
length(fun_giniw)
SE_lin <- function(object, design){
if(length(object)==2){
x<- update(design ,t=object$lin)
return(SE(svytotal(~t,design )))
}
lincomp<- object$statistic.lin
list_se<-lapply(lincomp,
function(t){
x<- update(design,t=t)
SE(svytotal(~t,design ) )
}
)
names(list_se)<-object[[1]]
list_se
}
SE_lin(fun_giniw,des_eusilc )
SE_lin <- function(object, design){
if(length(object)==2){
x<- update(design ,t=object$lin)
res<-SE(svytotal(~t,design ))
}
else{
lincomp<- object$statistic.lin
res<-lapply(lincomp,
function(t){
x<- update(design,t=t)
SE(svytotal(~t,design ) )
}
)
names(res)<-object[[1]]
}
res
}
SE_lin(fun_giniw,des_eusilc )
library(convey)
?svyarpr
devtools::document()
?svyrmpg
library(devtools)
install_github("DjalmaPessoa/convey")
library("convey", lib.loc="~/R/win-library/3.2")
library(devtools)
install_github("DjalmaPessoa/convey")
library("convey", lib.loc="~/R/win-library/3.2")
library(convey)
search()
source('~/GitHub/convey/tests.R', echo=TRUE)
h_fun
svyarpr()
svyarpr
library(convey)
h_fun
densfun
complete
h_fun<-function(inc_var, w){
N<-sum(w)
sd_inc <- sqrt((sum(w*inc_var*inc_var)-sum(w*inc_var)*sum(w*inc_var)/N)/N)
h <-sd_inc/exp(0.2*log(sum(w)))
h
}
source('~/GitHub/convey/R/all_funs.R', echo=TRUE)
source('~/GitHub/convey/tests.R', echo=TRUE)
source('~/GitHub/convey/tests.R', echo=TRUE)
source('~/GitHub/convey/tests.R', echo=TRUE)
source('~/GitHub/convey/tests.R', echo=TRUE)
fun_arptw <-  svyarpt(~eqIncome, design=des_eusilc, .5, .6, h=htot,
ncom=nrow(des_eusilc$variables), comp=TRUE)
htot<- h_fun(eusilc$eqIncome,eusilc$rb050)
fun_arptw <-  svyarpt(~eqIncome, design=des_eusilc, .5, .6, h=htot,
ncom=nrow(des_eusilc$variables), comp=TRUE)
library(vardpoor)
data(eusilc)
library(survey)
htot <- h_fun(eusilc$eqIncome, eusilc$rb050)
des_eusilc <- svydesign(ids=~db040, weights=~rb050, data=eusilc)
arpt_eqIncome <-svyarpt(~eqIncome, design=des_eusilc, .5, .6, h = htot,
ncom=nrow(eusilc), comp=TRUE)
library(vardpoor)
data(eusilc)
library(survey)
htot <- h_fun(eusilc$eqIncome, eusilc$rb050)
des_eusilc <- svydesign(ids=~db040, weights=~rb050, data=eusilc)
arpt_eqIncome<-svyarpt(~eqIncome, design=des_eusilc, .5, .6, h = htot, ncom=nrow(eusilc), comp=TRUE)
arpr_eqIncome<- svyarpr(~eqIncome, design=des_eusilc, .5, .6, h = htot,
ARPT = arpt_eqIncome, ncom=nrow(eusilc), comp=TRUE)
library(survey)
arpt_eqIncome<-svyarpt(~eqIncome, design=des_eusilc, .5, .6, h = htot, ncom=nrow(eusilc), comp=TRUE)
svyarpr
svyarpr <-function( formula , design , ... ){
UseMethod( "svyarpr" , design )
}
svyarpt <-  function( formula , design , ... ){
UseMethod( "svyarpt" , design )
}
arpt_eqIncome <-svyarpt(~eqIncome, design=des_eusilc, .5, .6, h = htot,
ncom=nrow(eusilc), comp=TRUE)
search()
svyquantile(~eqIncome, des_eusilc, .5 , ci=TRUE)
SE(svyquantile(~eqIncome, des_eusilc, .5 , ci=TRUE))
lin_median<-iqalpha(~eqIncome, des_eusilc, .5, h=NULL, ncom= nrow(eusilc),
comp=TRUE, incvec=eusilc$eqIncome)
names(lin_median)
lin_median$value
SE(svyquantile(~eqIncome, des_eusilc, .5 , ci=TRUE, method="constant"))
lin_median$value
SE_lin <- function(object, design){
lincomp<- object$statistic.lin
list_se<-lapply(lincomp,
function(t){
x<- update(design,t=t)
SE(svytotal(~t,design ) )
}
)
names(list_se)<-object[[1]]
list_se
}
SE_lin(lin_median, des_eusilc)
SE_lin <- function(object, design){
lincomp<- object$statistic.lin
list_se<-lapply(lincomp,
function(t){
x<- update(design,t=t)
SE(svytotal(~t,design ) )
}
names(list_se)<-object[[1]]
)
list_se
}
names(lin_median)
SE_lin <- function(object, design){
if(length(object)==2){
t<-object$lin
x<- update(design,t=t)
res<-SE(svytotal(~t,design ))
}
else{
lincomp<- object$statistic.lin
list_se<-lapply(lincomp,
function(t){
x<- update(design,t=t)
SE(svytotal(~t,design ) )
}
)
names(list_se)<-object[[1]]
res<- list_se
}
res
}
SE_lin(lin_median, des_eusilc)
SE(svyquantile(~eqIncome, des_eusilc, .5 , ci=TRUE, method="constant"))
SE(svyquantile(~eqIncome, des_eusilc, .5 , ci=TRUE, method="constant"))
svyquantile(~eqIncome, des_eusilc, .5 , ci=TRUE, method="constant")
SE(svyquantile(~eqIncome, des_eusilc, .5 , ci=TRUE, method="constant"))
SE_lin(lin_median, des_eusilc)
(248.087-239.93)/248.087
fun_qsrw<-svyqsr(~eqIncome, des_eusilc, .20, h=htot, ncom=nrow(des_eusilc$variables),
comp=TRUE, incvec = eusilc$eqIncome)
install_github("DjalmaPessoa/convey")
fun_arptw <-  svyarpt(~eqIncome, design=des_eusilc, .5, .6, h=htot,
ncom=nrow(des_eusilc$variables), comp=TRUE)
devtools::document()
devtools::document()
devtools::document()
h_fun<-function(inc_var, w){
N<-sum(w)
sd_inc <- sqrt((sum(w*inc_var*inc_var)-sum(w*inc_var)*sum(w*inc_var)/N)/N)
h <-sd_inc/exp(0.2*log(sum(w)))
h
}
library(vardpoor)
data(eusilc)
library(survey)
htot <- h_fun(eusilc$eqIncome, eusilc$rb050)
des_eusilc <- svydesign(ids=~db040, weights=~rb050, data=eusilc)
arpt_eqIncome <-svyarpt(~eqIncome, design=des_eusilc, .5, .6, h = htot,
ncom=nrow(eusilc), comp=TRUE)
search()
library(convey)
arpt_eqIncome <-svyarpt(~eqIncome, design=des_eusilc, .5, .6, h = htot,
ncom=nrow(eusilc), comp=TRUE)
library(convey)
search()
source('~/GitHub/convey/tests.R', echo=TRUE)
h_fun<-function(inc_var, w){
N<-sum(w)
sd_inc <- sqrt((sum(w*inc_var*inc_var)-sum(w*inc_var)*sum(w*inc_var)/N)/N)
h <-sd_inc/exp(0.2*log(sum(w)))
h
}
source('~/GitHub/convey/tests.R', echo=TRUE)
source('~/GitHub/convey/R/svyarpt.R', echo=TRUE)
source('~/GitHub/convey/tests.R', echo=TRUE)
source('~/GitHub/convey/R/all_funs.R', echo=TRUE)
source('~/GitHub/convey/tests.R', echo=TRUE)
source('~/GitHub/convey/R/svyarpr.R', echo=TRUE)
source('~/GitHub/convey/tests.R', echo=TRUE)
source('~/GitHub/convey/R/svyrmpg.R', echo=TRUE)
source('~/GitHub/convey/tests.R', echo=TRUE)
source('~/GitHub/convey/R/svyqsr.R', echo=TRUE)
source('~/GitHub/convey/tests.R', echo=TRUE)
source('~/GitHub/convey/R/svygini.R', echo=TRUE)
source('~/GitHub/convey/R/svygini.R', echo=TRUE)
source('~/GitHub/convey/tests.R', echo=TRUE)
